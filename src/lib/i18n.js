import React from 'react';

const STORAGE_KEY = 'putikunn:lang';
const DEFAULT_LANG = 'et';

const EN_TRANSLATIONS = {
  'lang.et': 'Estonian',
  'lang.en': 'English',
  'home.logout': 'Log out',
  'home.welcome': 'Welcome, {name}!',
  'home.ready': 'Ready to putt?',
  'home.host': 'Host game',
  'home.host_sub': 'Create session',
  'home.join': 'Join game',
  'home.join_sub': 'Enter PIN',
  'home.join_training': 'Join training',
  'home.training': 'Training',
  'home.solo': 'Solo training',
  'home.solo_sub': 'Practice solo',
  'home.records': 'Records',
  'home.records_sub': 'Leaderboards',
  'home.king': 'King',
  'home.king_sub': 'Tournaments',
  'home.profile': 'My profile',
  'home.profile_sub': 'Stats',
  'home.manage': 'Manage games',
  'home.manage_sub': 'Admin',
  'home.trainer': 'Trainer',
  'home.trainer_sub': 'Groups & projector',
  'home.admin': 'Users',
  'home.admin_sub': 'Super admin',
  'home.guest': 'Guest',

  'game.closed': 'Game is closed',

  'host.title': 'Host game',
  'host.solo_title': 'Solo training',
  'host.session_name': 'Session name (optional)',
  'host.session_placeholder': 'e.g. Thursday training',
  'host.start': 'Start',
  'host.pin_label': 'PIN',
  'host.copy': 'Copy',
  'host.copied': 'Copied!',
  'host.format': 'Game format',
  'host.putt_style': 'Putting style',
  'host.discs': 'Discs',
  'host.rules': 'Rules',
  'host.name_required': 'Give the game a name',
  'host.default_name': 'Game {date}',
  'host.exit': 'Exit',
  'host.game_pin': 'Game PIN',
  'host.copied': 'Copied',
  'host.players_count': '{count} players',
  'host.best_score': 'Best score',
  'host.most_laps': 'Most laps',
  'host.attempts': 'Attempts',
  'host.current': 'Current',
  'host.laps': 'Laps',
  'host.live_results': 'Live results',
  'host.auto_update': 'Auto-updating',
  'host.accuracy': 'Accuracy',
  'host.max': 'Max',
  'host.score_label': 'Score',
  'host.close_game': 'Close game',
  'host.game_closed': 'Game closed',
  'host.end_game': 'End game',
  'host.submit_leaderboard': 'Submit to leaderboard',
  'host.submit_discgolf': 'Submit to Discgolf.ee',
  'host.view_results': 'View all results',
  'host.waiting_players': 'Waiting for players to join...',
  'host.share_pin': 'Share PIN:',
  'host.completed_toast': 'Game completed!',
  'host.closed_toast': 'Game closed',
  'host.leaderboard_sent': 'Submitted to leaderboard',
  'host.discgolf_sent': 'Submitted to Discgolf.ee',

  'putt.regular': 'Regular',
  'putt.straddle': 'Straddle',
  'putt.turbo': 'Turbo',
  'putt.kneeling': 'Kneeling',
  'putt.marksman': 'Marksman',

  'format.classic.name': 'Classic',
  'format.classic.desc': 'Standard format',
  'format.mini_league.name': 'Mini League',
  'format.mini_league.desc': 'Classic 10 rounds',
  'format.duel.name': 'Friendly duel',
  'format.duel.desc': 'Duel with PIN',
  'format.back_and_forth.name': 'Back & Forth',
  'format.back_and_forth.desc': 'Made → farther, Miss → closer',
  'format.short.name': 'Short',
  'format.short.desc': 'Short distance practice',
  'format.long.name': 'Long',
  'format.long.desc': 'Long distance challenge',
  'format.streak_challenge.name': 'Streak',
  'format.streak_challenge.desc': 'Choose distance, ends on miss',
  'format.random_distance.name': 'Random',
  'format.random_distance.desc': 'Random distance each round',
  'format.time_ladder.name': 'Time challenge',
  'format.time_ladder.desc': 'Timer + 5 in a row → +1m',
  'format.around_the_world.name': 'Around the World',
  'format.around_the_world.desc': 'Move station by station',

  'rules.classic.title': 'Classic rules',
  'rules.range_label': 'Range',
  'rules.start_label': 'Start',
  'rules.classic.range': '5m - 10m',
  'rules.classic.start': '10m',
  'rules.classic.1': 'Start from 10m, throw 5 discs',
  'rules.classic.2': 'Next distance depends on made putts:',
  'rules.classic.3': '0 made → 5m',
  'rules.classic.4': '1 made → 6m',
  'rules.classic.5': '2 made → 7m',
  'rules.classic.6': '3 made → 8m',
  'rules.classic.7': '4 made → 9m',
  'rules.classic.8': '5 made → 10m',
  'rules.classic.9': 'Points = distance × made',
  'rules.classic.10': 'Play 20 rounds (100 putts)',

  'rules.mini_league.title': 'Mini League rules',
  'rules.mini_league.range': '5m - 10m',
  'rules.mini_league.start': '10m',
  'rules.mini_league.1': 'Classic format, but 10 rounds (50 putts)',
  'rules.mini_league.2': 'Start from 10m, throw 5 discs',
  'rules.mini_league.3': 'Next distance depends on made putts (0→5m … 5→10m)',
  'rules.mini_league.4': 'Points = distance × made',

  'rules.short.title': 'Short rules',
  'rules.short.range': '3m - 8m',
  'rules.short.start': '8m',
  'rules.short.1': 'Start from 8m, throw 5 discs',
  'rules.short.2': 'Next distance depends on made putts:',
  'rules.short.3': '0 made → 3m',
  'rules.short.4': '1 made → 4m',
  'rules.short.5': '2 made → 5m',
  'rules.short.6': '3 made → 6m',
  'rules.short.7': '4 made → 7m',
  'rules.short.8': '5 made → 8m',
  'rules.short.9': 'Points = distance × made',
  'rules.short.10': 'Play 20 rounds (100 putts)',

  'rules.long.title': 'Long rules',
  'rules.long.range': '10m - 15m',
  'rules.long.start': '15m',
  'rules.long.1': 'Start from 15m, throw 5 discs',
  'rules.long.2': 'Next distance depends on made putts:',
  'rules.long.3': '0 made → 10m',
  'rules.long.4': '1 made → 11m',
  'rules.long.5': '2 made → 12m',
  'rules.long.6': '3 made → 13m',
  'rules.long.7': '4 made → 14m',
  'rules.long.8': '5 made → 15m',
  'rules.long.9': 'Points = distance × made',
  'rules.long.10': 'Play 20 rounds (100 putts)',

  'rules.back_and_forth.title': 'Back & Forth rules',
  'rules.back_and_forth.range': '5m - 10m',
  'rules.back_and_forth.start': '5m',
  'rules.back_and_forth.1': 'Start from 5m, throw 1 disc at a time',
  'rules.back_and_forth.2': 'Made → distance +1m',
  'rules.back_and_forth.3': 'Miss → distance -1m',
  'rules.back_and_forth.4': 'Distance stays between 5–10m',
  'rules.back_and_forth.5': 'Each made putt scores its distance',
  'rules.back_and_forth.6': 'Example: made from 7m = 7 points',
  'rules.back_and_forth.7': 'Play 20 rounds (100 putts)',

  'rules.duel.title': 'Friendly duel rules',
  'rules.duel.range': '5m - 10m',
  'rules.duel.start': '5m',
  'rules.duel.1': 'Duel 1 vs 1, join with PIN',
  'rules.duel.2': 'Host chooses discs (1/3/5)',
  'rules.duel.3': 'Both enter results in parallel',
  'rules.duel.4': 'Winner moves +1m, loser stays',
  'rules.duel.5': 'Tie → repeat same distance',
  'rules.duel.6': 'Winning at 10m ends that station',

  'rules.streak.title': 'Streak rules',
  'rules.streak.range': '3m - 15m',
  'rules.streak.start': 'Choose distance',
  'rules.streak.1': 'Pick distance and throw 1 disc at a time',
  'rules.streak.2': 'Made → streak +1, Miss → streak 0',
  'rules.streak.3': 'Result = best streak',
  'rules.streak.4': 'Finish when you want',

  'rules.random.title': 'Random rules',
  'rules.random.range': '3m - 10m',
  'rules.random.start': 'Random',
  'rules.random.1': 'Each round distance is random (3–10m)',
  'rules.random.2': 'Throw 5 discs, 20 rounds (100 putts)',
  'rules.random.3': 'Points = distance × made',

  'rules.time_ladder.title': 'Time challenge rules',
  'rules.time_ladder.range': '5m - 10m',
  'rules.time_ladder.start': '5m',
  'rules.time_ladder.1': 'Start from 5m',
  'rules.time_ladder.2': '5 in a row → distance +1m (physical tracking)',
  'rules.time_ladder.3': 'Miss → streak reset',
  'rules.time_ladder.4': 'App is timer only: Start at beginning, Stop at finish',
  'rules.time_ladder.5': 'Result = time (smaller is better)',

  'rules.atw.title': 'Around the World rules',
  'rules.atw.range': '5m - 10m',
  'rules.atw.start': '5m',
  'rules.atw.1': 'Move 5m → 10m → 5m, full loop = 1 lap',
  'rules.atw.2': 'Difficulty = discs + advance threshold',
  'rules.atw.3': '3+ discs: 2+ misses or 0 made → back to 5m',
  'rules.atw.4': 'Points = distance × made (best attempt at distance counts)',

  'join.title': 'Join game',
  'join.name_label': 'Your name',
  'join.name_placeholder': 'Enter name',
  'join.pin_label': 'Game PIN',
  'join.pin_placeholder': 'Enter 4-digit PIN',
  'join.error_missing': 'Enter PIN and your name',
  'join.error_not_found': 'Game not found. Check PIN.',
  'join.error_closed': 'Game is closed by host.',
  'join.error_failed': 'Failed to join game',
  'join.button': 'Join game',
  'join.active_games': 'Active games',
  'join.players_singular': 'player',
  'join.players_plural': 'players',
  'join.no_date': 'Date missing',

  'player.completed': 'Completed!',
  'player.completed_sub': 'You finished the challenge',
  'player.completed_all': 'You finished all rounds',
  'player.submit_leaderboard': 'Submit to leaderboard',
  'player.view_leaderboard': 'View leaderboard',
  'player.exit': 'Exit game',
  'player.hide': 'Hide',
  'player.show': 'Show',
  'player.points': 'Points',
  'player.putts': 'Putts',
  'player.round': 'Round',
  'player.best_streak': 'Best streak',
  'player.show_leaderboard': 'Show leaderboard',
  'player.time': 'Time',
  'player.start_timer': 'Start timer',
  'player.stop_timer': 'Stop',
  'player.sees': 'Made',
  'player.miss': 'Miss',
  'player.current_streak': 'Current streak',
  'player.was_made': 'Did the putt go in?',
  'player.undo_last': 'Undo last',
  'player.select_made': 'Select how many putts went in (out of 5)',
  'player.in_a_row': 'in a row',
  'player.distance': 'Distance',
  'player.choose_distance': 'Choose distance',
  'player.start_streak': 'Start streak from {distance}m',
  'player.finish_training': 'Finish training',
  'player.points_abbr': 'pts',
  'player.points_value': '{score} points',
  'player.round_of': 'Round {current}/{total}',
  'player.discs_count': '{count} discs',
  'player.submit_success': 'Result submitted to leaderboard',

  'time.setup.title': 'Time challenge',
  'time.setup.subtitle': 'Solo training',
  'time.setup.name_label': 'Game name (optional)',
  'time.setup.name_placeholder': 'e.g. Time challenge',
  'time.setup.discs': 'Discs',
  'time.setup.start': 'Start training',
  'time.setup.howto': 'How to play?',
  'time.setup.rule1': 'Start from 5m, goal is 10m',
  'time.setup.rule2': '5 in a row → move +1m (physical tracking)',
  'time.setup.rule3': 'Miss → streak reset',
  'time.setup.rule4': 'In app only timer: Start at beginning, Stop at finish',

  'result.share': 'Share results',
  'result.delete': 'Delete',
  'result.submit': 'Submit to leaderboard',
  'result.submitted': 'Submitted',
  'result.submit_dg': 'Submit to Discgolf.ee',
  'result.date_missing': 'Date missing',
  'result.player': 'Player',
  'result.total': 'Total',
  'result.format': 'Format',
  'result.date': 'Date',
  'result.best_time': 'Best time',
  'result.time_challenge': 'Time challenge',
  'result.game_not_found': 'Game not found',
  'result.results_label': 'Results',
  'result.share_copied': 'Results copied to clipboard!',
  'result.share_failed': 'Sharing failed. Please copy manually.',
  'result.confirm_delete': 'Delete this game? This cannot be undone.',
  'result.best_higher': 'Your best result ({score}) is better than this game',
  'result.discgolf_sent': 'Submitted to Discgolf.ee and general leaderboard',
  'result.discgolf_summary': '({created} new, {updated} updated, {skipped} skipped)',
  'result.points_short': 'pts',
  'result.time_rules': 'Timer: Start at beginning, Stop at finish. 5 in a row → +1m, miss → streak reset.',

  'performance.title': 'Performance analysis',
  'performance.best_zone': 'Best zone',
  'performance.challenge_zone': 'Challenge zone',
  'performance.attempts': '{count} attempts',
  'performance.distance_results': 'Distance results',
  'performance.made_ratio': '{made}/{total} made',

  'profile.history': 'Game history',
  'profile.all_formats': 'All formats',
  'profile.all_styles': 'All styles',
  'profile.date': 'Date',
  'profile.score': 'Score',
  'profile.status': 'Status',
  'profile.active': 'Active',
  'profile.completed': 'Completed',
  'profile.delete_selected': 'Delete selected',
  'profile.none': 'No games found'
};

const LanguageContext = React.createContext({
  lang: DEFAULT_LANG,
  setLang: () => {},
  t: (_key, fallback) => fallback || _key
});

export function LanguageProvider({ children }) {
  const [lang, setLangState] = React.useState(() => {
    if (typeof window === 'undefined') return DEFAULT_LANG;
    const stored = window.localStorage.getItem(STORAGE_KEY);
    return stored || DEFAULT_LANG;
  });

  const setLang = React.useCallback((nextLang) => {
    setLangState(nextLang);
    if (typeof window !== 'undefined') {
      window.localStorage.setItem(STORAGE_KEY, nextLang);
      if (document?.documentElement) {
        document.documentElement.lang = nextLang;
      }
    }
  }, []);

  const t = React.useCallback((key, fallback, vars) => {
    const template = lang === 'et'
      ? (fallback ?? key)
      : (EN_TRANSLATIONS[key] ?? fallback ?? key);
    if (!vars) return template;
    return template.replace(/\{(\w+)\}/g, (_, token) => {
      return vars[token] !== undefined ? String(vars[token]) : `{${token}}`;
    });
  }, [lang]);

  return React.createElement(
    LanguageContext.Provider,
    { value: { lang, setLang, t } },
    children
  );
}

export function useLanguage() {
  return React.useContext(LanguageContext);
}
